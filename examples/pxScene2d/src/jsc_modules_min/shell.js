var isDuk="undefined"!=typeof Duktape,isV8="undefined"!=typeof _isV8,isJSC="undefined"!=typeof _isJSC;px.import({scene:"px:scene.1.js",keys:"px:tools.keys.js"}).then(function a(b){function c(a){isDuk||isV8||console.log("Received uncaught exception "+a.stack)}function d(a){isDuk||isV8||console.log("Received uncaught rejection.... "+a)}function e(a){return a&&0<a.toLowerCase().indexOf(".js?")?a:(a&&!a.match(/\.js$/)&&(a="mimeScene.js?url="+a),a)}function f(a,b){m.w=a,m.h=b,l.w=a,l.h=b}function g(){isDuk||isV8||isJSC||(process.removeListener("uncaughtException",c),process.removeListener("unhandledRejection",d))}var h=b.scene,i=b.keys;isDuk||isV8||isJSC||(process.on("uncaughtException",c),process.on("unhandledRejection",d));var j=queryStringModule.parse(urlModule.parse(module.appSceneContext.packageUrl).query).url;j=e(j);var k=j&&""!==j?j:"browser.js";console.log("url:",k);var l=h.create({t:"rect",fillColor:255,x:0,y:0,w:1280,h:720,a:0,parent:h.root}),m=h.create({t:"scene",url:k,parent:h.root});m.focus=!0;var n=!1,o=h.create({t:"rect",fillColor:128,lineColor:4294901888,lineWidth:3,x:10,y:10,a:n?1:0,parent:h.root}),p=h.create({t:"text",x:5,textColor:4294967295,pixelSize:24,text:"0fps",parent:o});if(o.w=p.w+16,o.h=p.h,o.interactive=!1,p.interactive=!1,h.on("onResize",function(a){f(a.w,a.h)}),h.on("onFPS",function(a){n&&(p.text=""+Math.floor(a.fps)+"fps",o.w=p.w+16,o.h=p.h)}),null!=h.capabilities&&null!=h.capabilities.graphics&&1==h.capabilities.graphics.cursor){var q=void 0,r=h.create({t:"image",url:"cursor.png",parent:h.root,interactive:!1,a:0});h.on("onMouseMove",function(a){null!=q&&clearTimeout(q),q=setTimeout(function(){r.animate({a:0},2,h.animation.TWEEN_LINEAR,h.animation.LOOP,1)},5e3),r.a=1,r.x=a.x-40,r.y=a.y-16})}h.root.on("onPreKeyDown",function(a){var b=a.keyCode,c=a.flags,d=!isJSC&&process.env.PXSCENE_KEY_LOGGING_DISABLED;if(d&&"1"===d?console.log("onPreKeyDown value hidden"):console.log("SHELL: onPreKeyDown:",b," key: ",i.name(b),", ",c),i.is_CTRL_ALT(c)){if(b==i.Y)n=!n,o.a=n?1:0,a.stopPropagation();else if(b==i.O)h.showOutlines=!h.showOutlines,a.stopPropagation();else if(b==i.S){if(!isDuk&&!isV8&&!isJSC){var e=h.screenshot("image/png;base64"),f=e.slice(e.indexOf(",")+1);fs.writeFile("screenshot.png",new Buffer(f,"base64"),function(a){a?console.log("Error creating screenshot.png"):console.log("Created screenshot.png")})}a.stopPropagation()}else b==i.D?(h.showDirtyRect=!h.showDirtyRect,a.stopPropagation()):b==i.T&&(h.enableDirtyRect=!h.enableDirtyRect,a.stopPropagation());}else if(i.is_CTRL_ALT_SHIFT(c))if(b==i.R)console.log("Reloading url: ",k),m.url=k,a.stopPropagation();else if(b==i.H){var g="browser.js";console.log("Loading home url: ",g),m.url=g,a.stopPropagation()}else b==i.D&&h.logDebugMetrics()}),h.root.on("onPreKeyUp",function(a){var b=!isJSC&&process.env.PXSCENE_KEY_LOGGING_DISABLED;b&&"1"===b?console.log("onPreKeyUp value hidden"):console.log("in onPreKeyUp",a.keyCode,a.flags);var c=a.keyCode,d=a.flags;b&&"1"===b?console.log("onKeyUp value hidden"):console.log("onKeyUp:",c,", ",d),c==i.Y&&i.is_CTRL_ALT(d)?a.stopPropagation():c==i.O&&i.is_CTRL_ALT(d)?a.stopPropagation():c==i.S&&i.is_CTRL_ALT(d)?a.stopPropagation():c==i.D&&i.is_CTRL_ALT(d)?a.stopPropagation():c==i.T&&i.is_CTRL_ALT(d)?a.stopPropagation():c==i.R&&i.is_CTRL_ALT_SHIFT(d)?a.stopPropagation():c==i.H&&i.is_CTRL_ALT_SHIFT(d)&&a.stopPropagation()}),h.root.on("onKeyDown",function(a){var b=a.keyCode,c=a.flags,d=!isJSC&&process.env.PXSCENE_KEY_LOGGING_DISABLED;if(d&&"1"===d?console.log("onKeyDown value hidden"):console.log("onKeyDown shell:",b,", ",c),i.is_CTRL_ALT(c))if(b==i.R)console.log("(shell.js) Reloading url: ",k),m.url=k,a.stopPropagation();else if(b==i.H){var e="browser.js";console.log("Loading home url: ",e),m.url=e,a.stopPropagation()}}),h.root.on("onPreChar",function(a){console.log("in onchar");var b=a.charCode,c=!isJSC&&process.env.PXSCENE_KEY_LOGGING_DISABLED;c&&"1"===c?console.log("onChar value hidden"):console.log("onChar:",b),32>b&&(console.log("stop onChar"),a.stopPropagation())}),h.on("onResize",function(a){f(a.w,a.h)}),f(h.w,h.h),m.ready.then(function(){void 0!==typeof m.api&&"function"==typeof m.api.wantsClearscreen?m.api.wantsClearscreen()&&(l.a=1):l.a=1}),h.on("onClose",g)});