"use strict";var FileArchive=require("rcvrcore/utils/FileArchive"),SceneModuleManifest=require("rcvrcore/SceneModuleManifest"),Logger=require("rcvrcore/Logger").Logger,log=new Logger("SceneModuleLoader");function SceneModuleLoader(){this.fileArchive=null,this.manifest=null,this.loadedJarFile=!1,this.defaultManifest=!1}SceneModuleLoader.prototype.loadScenePackage=function(a,b){b.fileUri=b.fileUri.replace("%20"," ");var c=b.fileUri,d=this;return new Promise(function(e,f){a.loadArchive(b.fileUri).ready.then(function(b){b.loadStatus.httpStatusCode&&200!=b.loadStatus.httpStatusCode?(console.error("http status is not 200 rejecting"),f(b.loadStatus)):(log.message(4,"loadScenePackage: loadArchive succeeded for ("+c+")."),d.fileArchive=new FileArchive(c,b),log.message(4,"Number of files: "+b.fileNames.length),d.loadedJarFile=1<b.fileNames.length,log.message(10,"LoadedFromJarFile= "+d.loadedJarFile),isFileInList("package.json",b.fileNames)?(log.message(10,"Has package.json"),d.fileArchive.addFile("package.json",b.getFileAsString("package.json")),d.defaultManifest=!1):(log.message(10,"Doesn't have package.json"),d.fileArchive.addFile("package.json","{ \"main\" : \""+c+"\" }"),d.defaultManifest=!0),d.manifest=new SceneModuleManifest,d.manifest.loadFromJSON(d.fileArchive.getFileContents("package.json")),e())},function(b){console.error("loadScenePackage: loadArchive failed for (",c,")."),f(b.loadStatus)})})};function isFileInList(a,b){for(var c=0;c<b.length;++c)if(b[c]===a)return!0;return!1}SceneModuleLoader.prototype.processFileData=function(a,b){this.fileArchive=new FileArchive(a),80===b[0]&&75===b[1]&&3===b[2]&&4===b[3]?this.fileArchive.loadFromJarData(b):(this.fileArchive.addFile("package.json","{ \"main\" : \""+a+"\" }"),this.fileArchive.addFile(a,b),this.defaultManifest=!0)},SceneModuleLoader.prototype.getFileArchive=function(){return this.fileArchive},SceneModuleLoader.prototype.getManifest=function(){return this.manifest},SceneModuleLoader.prototype.isDefaultManifest=function(){return this.defaultManifest},SceneModuleLoader.prototype.jarFileWasLoaded=function(){return this.loadedJarFile},module.exports=SceneModuleLoader;