"use strict";var isDuk="undefined"!=typeof Duktape;if(!isDuk)var JSZip=require("jszip");var Logger=require("rcvrcore/Logger").Logger,log=new Logger("FileUtils");function FileArchive(a,b){this.filePath=a,this.baseFilePath=a.substring(0,a.lastIndexOf("/")),this.numEntries=0,this.directory={},this.jar=null,this.nativeFileArchive=b}FileArchive.prototype.removeFile=function(a){return!!this.directory.hasOwnProperty(a)&&(this.directory[a]=null,delete this.directory[a],--this.numEntries,!0)},FileArchive.prototype.getFileContents=function(a){if(log.message(10,"FileArchive::getFileContents<"+a+">"),this.directory.hasOwnProperty(a))return this.directory[a];var b=null;return(void 0!==this.nativeFileArchive&&(log.message(10,"Looking for file in native archive: "+a),b=this.nativeFileArchive.getFileAsString(a)),void 0===b||null===b)?(console.error("No file contents in ["+this.baseFilePath+"] for "+a),null):(log.message(10,"Found file <"+a+">: "+"ok"),b)},FileArchive.prototype.addFile=function(a,b){var c=!0;return this.directory.hasOwnProperty(a)&&(c=!1),this.directory[a]=b,++this.numEntries,c},FileArchive.prototype.loadFromJarData=function(a){var b=new JSZip(a);this.processJar(b),this.loadedJarFile=!0},FileArchive.prototype.processJar=function(a){for(var b in a.files){var c=a.files[b];!0!==c.options.dir&&this.addArchiveEntry(b,c.asText())}},FileArchive.prototype.addArchiveEntry=function(a,b){++this.numEntries,this.directory[a]=b},FileArchive.prototype.hasFileContents=function(a){var b=this.directory.hasOwnProperty(a);return!1===b&&void 0!==this.nativeFileArchive&&(b=isFileInList(a,this.nativeFileArchive.fileNames)),log.message(10,"hasFileContents("+a+") = "+b),b};function isFileInList(a,b){for(var c=0;c<b.length;++c)if(b[c]===a)return!0;return!1}module.exports=FileArchive;