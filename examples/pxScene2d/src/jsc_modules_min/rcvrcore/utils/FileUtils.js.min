"use strict";var isDuk="undefined"!=typeof Duktape,isV8="undefined"!=typeof _isV8,isJSC="undefined"!=typeof _isJSC,fs=require("fs"),http_global=require("http"),https_global=require("https"),url=require("url"),http_wrap=require("rcvrcore/http_wrap"),Logger=require("rcvrcore/Logger").Logger,log=new Logger("FileUtils");function loadFile(a,b){return new Promise(function(c,d){var e=[];if("http"===a.substring(0,4)){var f=url.parse(a),g=null,h=function(b){b.on("data",function(a){Buffer.isBuffer(a)?e.push(a):e.push(new Buffer(a))}),b.on("end",function(){if(200===b.statusCode){log.message(3,"Got file["+a+"] from web service");var f=Buffer.concat(e);c(f)}else log.error("StatusCode Bad: FAILED to read file["+a+"] from web service"),d(b.statusCode)})},i="https"===a.substring(0,5);g=b?new http_wrap(i?"https":"http",b).get(f,h):(i?https_global:http_global).get(f,h),isV8||isJSC||process._tickCallback(),g.on("error",function(b){log.error("Error: FAILED to read file["+a+"] from web service"),d(b)})}else{if(b&&b.innerscene&&b.innerscene.permissions&&!b.innerscene.permissions.allows(a))return console.log("local file access not allowed !!!"),void d("Local file access not allowed");"file:"===a.substring(0,5)&&(a=a.substring(5),"//"===a.substring(0,2)&&(a=a.substring(1))),fs.readFile(a,function(b,e){b?(log.error("FAILED to read file["+a+"] from file system (error="+b+")"),d(b)):(log.message(3,"Got file["+a+"] from file system"),c(e))})}})}function hasExtension(a,b){var c=a.lastIndexOf(b);return-1!==c&&c+b.length===a.length}module.exports={loadFile:loadFile,hasExtension:hasExtension};